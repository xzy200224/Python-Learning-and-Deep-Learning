## 处理流程

一、预处理：

1. 增强（Sharpen）：通过锐化图像边缘来提高图像的清晰度和细节。这可以帮助医生更好地分析图像并做出准确的诊断。
2. 平滑（Smooth）：平滑处理可以减少图像中的噪声，使图像更加清晰和易于分析。常见的平滑方法包括均值滤波、高斯滤波等。
3. 插值（Interpolate）：在医学图像处理中，有时候需要对图像进行放大或缩小操作。插值是一种基于已知像素值来推测未知像素值的方法，用于调整图像的尺寸和比例。
4. 减噪（Reduce noise）：医学图像中可能存在各种类型的噪声，如高斯噪声、椒盐噪声等。
5. 裁剪（Crop）：裁剪是指从原始图像中选择感兴趣区域（ROI）并将其提取出来。这可以帮助医生集中注意力分析关键部位，减少无关信息的干扰。

二、Segmentation

ROI（region of interest）是从图像中选择的一个图像区域，这个区域是你的图像分析所关注的重点。圈定该区域以便进行进一步处理。使用ROI圈定你想读的目标，可以减少处理时间，增加精度。

"Group"通常用于表示一组共享相同属性（如来自同一病人、同一模态）的图像.

"Label"通常用于标记和区分图像中的特定区域或对象，如肿瘤、血管、肺部边界等。例如，在图像分割任务中，我们通常会将图像分割成多个区域，每个区域都有一个对应的标签，表示该区域的类型。

三、Recognition

Object Matching/Template Matching是计算机视觉和图像处理中的一个基本问题，主要用于确定图像中的特定对象或场景之间的相似度。如归一化交叉相关或Dice系数。

四、Modeling

Volume Rendering，Deformable Model，Mathematical Model：三维建模，常用技术：VTK。

+++

## 灰度直方图与二值化

一、灰度直方图介绍

灰度直方图是一种用于表示图像中各个灰度级别的频率分布的统计图。在灰度图像中，每个像素的灰度值可以从0（表示黑色）到255（表示白色）。灰度直方图可以告诉我们每个灰度值对应的像素数量，从而反映出图像的亮度分布。

灰度直方图特点： 把整个图像浓缩在直方图中，丢失了所有的空间信息；灰度直方图按照x轴进行积分，就是图像的面积。
灰度直方图应用：

（1）设置图像的参数:
（2）分析图像灰度的变化，确定最优二值化的值：因为灰度直方图通常有一个属性，双峰性（bimodal）（一个称为前景峰值，另一个为背景峰值）。通常两个峰值之间的最小值，为我们想找的最优二值化的分界点。

二、直方图均衡化

直方图是图像的统计学特征。直方图举例：像素值直方图，边缘、方向，梯度直方图等等。
直方图有很多应用：均衡化（增强对比度）、有颜色物体跟踪…

图像直方图均值化都是基于灰度图。直方图均衡化自动调整图像对比度，使图像清晰，是图像增强的一个手段

三、二值化介绍（ 简单、没有前后关联的、基础、有效的图像分割算法。）

二值化是一种常用的图像处理技术，它可以将图像中的每个像素转换为两种可能的值，通常是0和255，这两种值通常代表黑色和白色。二值化的主要目的是简化图像，使其更容易进行进一步的处理和分析。二值化的过程通常涉及到选择一个阈值。如果像素的灰度值大于这个阈值，那么像素的值就被设置为255（白色）；如果像素的灰度值小于这个阈值，那么像素的值就被设置为0（黑色）。选择阈值的方法有很多种，包括固定阈值二值化和自适应阈值（局部阈值）。

## 卷积与滤波

![image-20240205122541735](医学图像处理.assets/image-20240205122541735.png)

### “edge”（边缘）

图像中的“edge”（边缘）是图像属性中的一种，它指的是图像亮度（或颜色）显著变化的地方。在视觉上，边缘通常对应于物体的轮廓、物体内部的分界线、纹理的变化等。在图像处理和计算机视觉中，边缘检测是一种基本而重要的技术，它用于捕捉图像中的重要特征，为图像分析、物体识别、场景理解等提供基础。

### 边缘检测的原理

边缘检测主要是通过寻找图像亮度快速变化的地方来实现的。这种变化通常表现为图像的梯度较大的区域。图像的梯度是指图像在某一点处亮度变化的最大方向和程度。因此，边缘检测的核心就是计算图像的梯度，并找出梯度值大的那些点。

### 如何求边缘

边缘检测通常通过以下步骤进行：

1. **噪声去除**：由于边缘检测对噪声非常敏感，因此通常首先使用平滑滤波器（如高斯滤波器）去除图像中的噪声。
2. **计算梯度**：使用梯度算子（如Sobel算子、Prewitt算子、Roberts算子、Canny算子等）来计算图像每个像素点的梯度大小和方向。这些算子通过与图像进行卷积来计算水平和垂直方向上的梯度，从而得到梯度的幅度和方向。
3. **非极大值抑制**（仅在一些方法中使用，如Canny边缘检测）：该步骤旨在细化梯度图像中的边缘。通过保留梯度方向上局部最大值点，并抑制其他非最大值点，使边缘更加细致。
4. **阈值处理**：通过设置一个或多个阈值来确定哪些地方的梯度强度足够大，可以被认为是边缘。在Canny边缘检测中，通常采用双阈值策略来识别强边缘、弱边缘和非边缘。

### 常见的边缘检测算子

- **Sobel算子**：通过计算图像在x和y方向上的一阶导数的近似值来检测边缘。
- **Canny算子**：是一种较为复杂的边缘检测算法，它考虑了信噪比和边缘定位精度，能有效控制错误检测。
- **Laplacian算子**：基于二阶导数，寻找零交叉点来检测边缘。
- **Prewitt算子**、**Roberts算子**：也是通过计算图像梯度的方法，但是采用不同的核来实现。

图像噪声降低（Noise Reduction），也称为图像去噪（Denoising），是图像处理中的一个重要环节，目的在于从图像中去除噪声或干扰，以提高图像质量。图像在获取、传输或处理过程中往往会引入各种噪声，如传感器噪声、压缩产生的噪声等，这些噪声会影响图像的视觉效果和后续处理的效果。

### 图像去噪的原理

图像去噪的基本原理是通过某种算法对图像的每个像素值进行调整，使其更接近其原始（无噪声）状态。这通常需要在去除噪声的同时尽可能保留图像的细节和结构信息，这是一项挑战，因为噪声和图像细节在频域中往往是重叠的。

### 如何进行图像去噪

图像去噪的方法很多，可以大致分为时域方法和频域方法两大类。时域方法直接在图像的像素上操作，而频域方法则是在图像的频谱上进行操作。

### 常见的图像去噪算法

1. **均值滤波**：通过将每个像素值设置为其邻域内像素值的平均值来去噪。这是最简单的去噪方法之一，但容易导致图像模糊，损失细节。
2. **中值滤波**：将每个像素值替换为其邻域内像素值的中位数。中值滤波对于去除椒盐噪声（salt-and-pepper noise）特别有效，且能较好地保留边缘。
3. **高斯滤波**：使用高斯函数作为权重对像素的邻域进行加权平均。高斯滤波是一种线性平滑滤波，能有效去除高斯噪声，同时较好地保持图像边缘。
4. **双边滤波**：同时考虑空间邻近度和像素值相似度，能在去噪的同时保护边缘。双边滤波对于保持边缘信息在图像去噪中非常有效。
5. **小波变换去噪**：通过对图像进行小波变换，然后根据噪声的特性对小波系数进行阈值处理，最后进行逆小波变换重构图像。小波去噪能在多尺度下分析图像，更好地平衡细节保持与去噪之间的关系。
6. **非局部均值去噪**（Non-Local Means Denoising）：考虑图像中重复的纹理和结构，通过对整个图像搜索相似的区块进行加权平均来去噪。这种方法在保持图像结构方面表现出色。

## 图像的基本操作和特征

### 点操作（point operation）：

点操作，又称为像素级操作，是指那些在单个像素上独立进行的操作。这类操作不考虑像素周围的上下文信息。点操作的典型例子包括：

![image-20240206174802393](医学图像处理.assets/image-20240206174802393.png)

### 代数操作（algebraic operation）：

这些操作涉及到对两个或多个图像进行数学运算，以便合成新的图像或提取有用信息。代数操作通常是基于像素的，意味着对图像中对应像素的数值进行计算。下面我们来详细探讨几种常见的代数操作。

1.图像加法

图像加法是将两个图像的对应像素值相加。这可以用于多种目的，如图像融合、噪声增加（用于测试）等。假设有两个图像A和B，结果图像C的每个像素 (C(x, y) = A(x, y) + B(x, y))。需要注意的是，在进行加法操作时可能会出现像素值溢出的情况（超过255），因此可能需要进行归一化或截断处理。

2. 图像减法

图像减法是从一个图像中减去另一个图像的对应像素值，通常用于背景减除、图像差异分析等。如果有两个图像A和B，结果图像C的每个像素 (C(x, y) = A(x, y) - B(x, y))。同样，减法操作后可能需要对结果进行调整，以确保所有像素值都在有效范围内（例如0到255）。

3. 图像乘法

图像乘法涉及到将两个图像的对应像素值相乘。这种操作可以用于图像掩模（masking）、调整图像亮度等。对于图像A和B，结果图像C的每个像素 (C(x, y) = A(x, y) * dot B(x, y))。乘法操作后，可能需要对结果进行缩放，以保持像素值在合理范围内。

4. 图像除法

图像除法是通过将一个图像的像素值除以另一个图像的对应像素值来完成的。这可以用于创建特殊效果或进行某些类型的图像恢复。对于图像A和B，结果图像C的每个像素 (C(x, y) = A(x, y) / B(x, y))，当然，需要注意避免除以零的情况。

###  集合操作（geometric operation）

1. 平移（Translation）

平移操作会将图像中的每个像素移动到一个新的位置，通常由水平偏移量（dx）和垂直偏移量（dy）来定义。在平移操作中，图像的形状和大小保持不变。

[x' = x + t_x] 

[y' = y + t_y]

2. 旋转（Rotation）

旋转操作会围绕一个旋转中心将图像中的像素旋转一个特定的角度。旋转操作可能导致图像的一部分超出原始图像的边界，因此可能需要对结果图像进行裁剪或填充。

[x' = x \cos(\theta) - y \sin(\theta)] 

[y' = x \sin(\theta) + y \cos(\theta)]

3. 缩放（Scaling）

缩放操作会改变图像的尺寸，可以是等比例缩放或非等比例缩放。等比例缩放会保持图像的纵横比，而非等比例缩放则可能会导致图像被拉伸或压缩。

4. 镜像（Mirroring）

镜像操作会沿着水平轴或垂直轴翻转图像，产生图像的镜像副本。这种操作在某些图像处理任务中很有用，例如在数据增强阶段生成更多的训练数据。

5. 仿射变换（Affine Transformation）

仿射变换是一种更复杂的几何变换，它可以通过组合多个简单的变换（如平移、旋转、缩放和倾斜）来实现。仿射变换保持了图像中线条的平行性，是一种线性变换加上平移。

6. 透视变换（Perspective Transformation）

透视变换是一种更高级的几何变换，它可以模拟相机视角的变化，如从一个角度查看物体时的视觉效果。透视变换可以创建或校正图像中的透视效果，使得图像看起来更加真实或符合特定的视觉需求。

应用示例

- **图像校正**：通过几何操作，可以校正图像中的畸变，如摄像头畸变、透视畸变等。
- **图像配准**：在将两个或多个图像叠加在一起进行比较或融合时，几何变换用于图像配准，确保图像正确对齐。
- **数据增强**：在机器学习和深度学习领域，通过对训练图像应用几何变换（如旋转、缩放、镜像），可以增加数据集的多样性，帮助提高模型的泛化能力。

### 插值算法(interpolation algorithm)

插值算法（Interpolation algorithms）在图像处理中扮演着非常重要的角色，特别是在进行图像缩放、旋转、透视变换等几何操作时，我们需要重新计算变换后图像像素点的值。插值算法就是用来估计这些新像素位置的颜色值的方法。以下是几种常见的插值算法：

1. 最近邻插值（Nearest Neighbor Interpolation）

最近邻插值是最简单的插值方法之一。它将目标图像中的每个像素值设置为源图像中最近像素的值。这种方法的优点在于计算速度快，但缺点是图像质量可能不是很高，尤其是在放大操作时，图像可能会出现明显的锯齿状边缘。

2. 双线性插值（Bilinear Interpolation）

双线性插值考虑了像素周围的四个最近的像素点，并基于距离进行加权平均，以此来计算目标像素的值。这种方法比最近邻插值提供了更平滑的图像效果，但计算量也相对较大。双线性插值在处理图像放大和缩小时是一个很好的折中方案，能够保持较好的图像质量。

3. 双三次插值（Bicubic Interpolation）

双三次插值是一种更为复杂的插值方法，它考虑了目标像素周围的16个像素（4x4邻域），并使用三次多项式来进行插值。这种方法通常能够产生比双线性插值更平滑、更自然的图像，特别是在图像放大时。然而，双三次插值的计算成本也更高。

4. Lanczos插值

Lanczos插值使用sinc函数的窗口化版本作为插值核心。这种方法在保留细节方面表现得非常好，尤其适合于图像缩放操作。Lanczos插值可以提供接近或超过双三次插值的图像质量，同时保持较高的计算效率。Lanczos插值的一个关键参数是“a”，它决定了使用多大的邻域进行计算，常见的选择是Lanczos-2或Lanczos-3。

5. 插值算法的选择

选择哪种插值算法取决于具体的应用需求。如果对图像质量的要求很高，并且可以接受较长的计算时间，双三次插值或Lanczos插值是很好的选择。如果需要快速处理图像，而对图像质量的要求相对较低，最近邻插值或双线性插值可能更合适。在实际应用中，还会考虑到其他因素，如内存使用、实现复杂度等。

### 邻域操作(neighbourhood operation)

邻域操作（Neighborhood Operations），也被称为局部操作或区域操作，是图像处理中的一种基本操作，它涉及到对图像中每个像素及其周围邻域内的像素进行处理。这类操作根据像素及其邻近像素的值来计算新的像素值，常用于图像滤波、边缘检测、特征增强等任务。以下是一些基本的邻域操作示例：

1. 平滑（Smoothing）或模糊（Blurring）

平滑操作通过减少图像中的强度变化（即噪声或细节）来使图像变得更加平滑。常见的平滑技术包括均值滤波、高斯滤波等。

- **均值滤波**：使用一个简单的滑动窗口（通常是正方形），将窗口内所有像素的平均值作为中心像素的新值。
- **高斯滤波**：使用一个基于高斯函数形状的权重窗口，对邻域内的像素进行加权平均。权重随着距离中心像素的距离增加而减小。

2. 锐化（Sharpening）

锐化操作旨在增强图像的边缘和细节，使图像看起来更清晰。这通常通过增强图像中的高频成分来实现。一个简单的锐化方法是使用拉普拉斯滤波器，它可以突出显示区域的快速变化。

3. 边缘检测（Edge Detection）

边缘检测是一种特殊的邻域操作，旨在识别图像中对象的边界。常用的边缘检测算法包括Sobel、Prewitt和Canny边缘检测器。这些方法通过计算图像中像素强度的梯度来识别边缘。

4. 邻域操作的一般步骤

1. **定义邻域大小**：选择一个窗口（邻域），它可以是3x3、5x5或其他大小，取决于具体应用。
2. **窗口滑动**：将窗口从图像的一个角开始，逐步滑动至整个图像，处理每一个像素点。
3. **计算新像素值**：根据特定的算法（如平均、加权平均、最大值、最小值等），使用窗口内的像素值计算当前位置像素的新值。
4. **边界处理**：对于图像边缘的像素，其邻域可能部分在图像外。这时，需要一种策略来处理这些情况，如扩展边缘像素、镜像、忽略等。

5. 注意事项

- 邻域操作通常会导致图像尺寸的变化，特别是在边缘处，因此在实际应用中需要考虑如何处理边界问题。
- 在执行邻域操作时，特别是在进行滤波时，可能会造成图像的某些特征（如边缘）的模糊，因此需要根据具体需求选择合适的操作和参数。

### 连通区域标记（Connected Component Labeling）

连通区域标记（Connected Component Labeling）是图像处理中的一种算法，用于识别图像中的连通区域，并为每个独立的连通区域分配一个唯一的标签。这个过程通常应用于二值图像，即图像被分为前景和背景两部分。连通区域标记的目的是识别所有属于同一对象的前景像素，并将它们归为同一组或区域。

1. 基本概念

- 连通区域

  ：在二值图像中，前景像素按一定的连接性准则（如4-连通或8-连通）相互连接形成的集合。

  - **4-连通**：如果两个像素在水平或垂直方向上相邻，则认为它们是连接的。
  - **8-连通**：如果两个像素在水平、垂直或对角线方向上相邻，则认为它们是连接的。

2. 算法步骤

连通区域标记算法的一般步骤如下：

(1)**初始化**：遍历图像的每个像素，为每个前景像素分配一个临时标签（通常从左上角开始遍历）。

(2)**扫描图像**：

- 在第一次扫描过程中，检查每个前景像素的邻域（根据4-连通或8-连通规则）。
- 如果邻域内没有已标记的像素，为当前像素分配一个新的标签。
- 如果邻域内有一个或多个已标记的像素，选择其中一个标签（最小的标签）应用于当前像素，并记录所有找到的标签之间的等价关系。

(3)**解析等价关系**：处理所有标签的等价关系，确保所有属于同一连通区域的像素拥有相同的最终标签。

(4)**第二次扫描**：再次遍历图像，根据等价关系表更新每个像素的标签，以确保所有属于同一连通区域的像素具有相同的唯一标签。

3. 应用

连通区域标记在图像分析中非常有用，常见的应用包括：

- 物体检测和计数：通过标记和分析连通区域，可以识别并计数图像中的物体数量。
- 形状分析：对每个连通区域进行进一步的几何和拓扑分析，提取形状特征。
- 图像分割：将图像分割成有意义的部分，为进一步的图像处理或分析提供基础。

### 区域属性（Region Properties）

区域属性（Region Properties）是指从图像的连通区域（或分割后的区域）中提取的特征，这些特征可以用来描述区域的几何形状、大小、位置、纹理等方面的信息。区域属性在图像分析、模式识别、计算机视觉等领域有着广泛的应用，比如物体识别、分类和追踪。以下是一些常见的区域属性：

1. 几何属性

- **面积**：区域内像素的总数。
- **周长**：区域边界的长度。对于数字图像，可以通过计算边界上的像素点数来近似表示。
- **质心（Centroid）**：区域的几何中心，可以通过对区域内所有像素的坐标求平均值得到。
- **边界矩形（Bounding Box）**：完全包含区域的最小矩形。
- **极性（Eccentricity）**：区域形状的椭圆度，描述区域形状接近于圆形还是线条形。
- **方向（Orientation）**：区域的主轴方向，反映了区域的伸展方向。
- **紧密度（Compactness）**：区域面积与其周长的比率，用于描述区域的形状复杂度。
- Bounding box：

![image-20240206182201722](医学图像处理.assets/image-20240206182201722.png)

2. 纹理属性

纹理属性描述了区域内像素值分布的规律性和复杂性，常用于区分具有不同表面特征的对象。

- **对比度（Contrast）**：反映了图像纹理中最亮和最暗区域之间的差异。
- **均匀性（Uniformity）**：当图像的局部非常一致时，均匀性值增加。
- **熵（Entropy）**：反映了图像纹理的复杂度，熵值越高，纹理越复杂。

3. 拓扑属性

拓扑属性描述了区域的连接性和孔洞的数量等特征。

- **欧拉数（Euler Number）**：区域中对象的数量减去孔洞的数量。

计算方法

区域属性的计算通常遵循以下步骤：

1. **图像预处理**：包括噪声去除、二值化等，以便更好地识别区域。
2. **区域标记**：使用连通区域标记算法识别并标记图像中的独立区域。
3. **属性计算**：对每个标记的区域，根据需要计算各种几何、纹理和拓扑属性。

应用

区域属性的提取对于许多图像处理和计算机视觉任务至关重要，包括：

- **物体检测和识别**：通过比较区域属性来识别图像中的特定物体。
- **图像分割**：基于区域属性对图像进行分割，将图像划分为具有相似特征的区域。
- **图像分类**：利用区域属性作为特征向量进行图像内容的分类。

## VTK与ITK

VTK（Visualization Toolkit）和ITK（Insight Segmentation and Registration Toolkit）是两个广泛用于医学图像处理和可视化的开源库，它们在功能上互补，在许多医学图像分析项目中同时被使用。尽管它们有共同的使用场景，但它们各自专注于不同的领域。

**VTK - Visualization Toolkit**

VTK是一个跨平台的开源库，主要用于3D计算机图形学、图像处理以及可视化。它支持多种编程语言，包括C++、Python、Java等。VTK提供了广泛的数据结构和算法，用于创建复杂的3D图形和图像可视化应用程序。VTK适用于科学研究、工程分析、数据可视化等领域。

VTK的特点包括：

- 支持多种2D和3D图像格式。
- 提供了丰富的3D模型渲染和动画制作功能。
- 包含高级算法，如体积渲染、表面重建、流场可视化等。
- 支持交互式和非交互式应用程序的开发。
- 强大的数据处理和可视化能力，可以处理来自不同领域（如流体动力学、分子生物学等）的数据。

**ITK - Insight Segmentation and Registration Toolkit**

ITK是专门为图像分割（Segmentation）和图像配准（Registration）设计的开源库。它广泛应用于医学图像处理领域，尤其是在处理CT、MRI等医学成像数据时。ITK使用C++编写，并提供了对Python的绑定，使得它既可以支持高性能的算法实现，也便于快速原型开发和测试。

ITK的特点包括：

- 强大的图像分割和配准算法，支持多种医学图像格式。
- 提供了广泛的图像滤波器、变换和分析工具。
- 高度模块化的设计，易于扩展和集成。
- 支持多线程，优化了算法的执行效率。
- 社区活跃，文档丰富，有大量的教程和示例代码。

## 二值的形态学

数字形态学（Digital Morphology）是图像处理和计算机视觉领域的一个重要分支，主要关注于图像的形状分析。它通过应用一系列基于形状的操作来分析和处理几何结构，特别是二值图像和灰度图像。数字形态学的操作基于集合论，使用数学形态学元素（称为结构元素）来量化和提取图像特征。

### 基本操作

数字形态学的基础操作主要包括膨胀（Dilation）、腐蚀（Erosion）、开运算（Opening）和闭运算（Closing）。

1. **膨胀（Dilation）**
   - 膨胀操作使图像中的物体边界向外扩展，可以用来填补物体内的小孔或连接邻近的物体。
   - 在二值图像中，如果结构元素与图像的交集非空，该位置的像素被设置为前景。、
   - ![image-20240207124052328](医学图像处理.assets/image-20240207124052328.png)
   - ![image-20240207124025797](医学图像处理.assets/image-20240207124025797.png)
2. **腐蚀（Erosion）**
   - 腐蚀操作使图像中的物体边界收缩，可以用来消除小物体或分离相邻的物体。
   - 在二值图像中，只有当结构元素完全包含在图像的某个部分时，该部分的中心像素才保持为前景。
   - ![image-20240207124420939](医学图像处理.assets/image-20240207124420939.png)
   - ![image-20240207125336218](医学图像处理.assets/image-20240207125336218.png)
3. **开运算（Opening）**
   - 开运算是先腐蚀后膨胀的过程，用于移除小物体、平滑较大物体的边界，而不明显改变其面积。
   - 开运算对消除小物体和分离物体的粘连非常有效。
4. **闭运算（Closing）**
   - 闭运算是先膨胀后腐蚀的过程，用于填充物体内的小孔和小裂缝，同时保持物体的主要形状。
   - 闭运算对填充物体中的小孔和连接近邻物体非常有效。
